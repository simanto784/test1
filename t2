#include <stdio.h>
#include <string.h>

#define MAX_Q 100
#define MAX_STUDENTS 3

// ---------------- Teacher login
char teacherPass[] = "teacher123";

// ---------------- Student login
struct Student {
    char id[20];
    char pass[20];
} students[MAX_STUDENTS] = {
    {"1001","abcd"},
    {"1002","1234"},
    {"1003","pass"}
};

// ---------------- Question structure
struct Question {
    char ques[200];
    char optA[100], optB[100], optC[100], optD[100];
    char correct;
} qList[MAX_Q];

int totalQ = 0;

// ---------------- Teacher Panel
void teacherPanel() {
    char pass[20];
    printf("\nEnter Teacher Password: ");
    scanf("%s", pass);
    if(strcmp(pass, teacherPass) != 0){
        printf("Wrong password!\n");
        return;
    }

    printf("\nLogin Successful!\n");
    printf("How many questions do you want to add? ");
    scanf("%d", &totalQ);

    for(int i=0; i<totalQ; i++){
        printf("\nEnter Question %d: ", i+1);
        getchar(); // clear buffer
        fgets(qList[i].ques, sizeof(qList[i].ques), stdin);

        printf("Option A: ");
        fgets(qList[i].optA, sizeof(qList[i].optA), stdin);

        printf("Option B: ");
        fgets(qList[i].optB, sizeof(qList[i].optB), stdin);

        printf("Option C: ");
        fgets(qList[i].optC, sizeof(qList[i].optC), stdin);

        printf("Option D: ");
        fgets(qList[i].optD, sizeof(qList[i].optD), stdin);

        printf("Correct Answer (A/B/C/D): ");
        scanf(" %c", &qList[i].correct);
    }

    printf("\nQuestions added successfully!\n");
}

// ---------------- Student Panel
void studentPanel() {
    char id[20], pass[20];
    printf("\nEnter Student ID: ");
    scanf("%s", id);
    printf("Enter Password: ");
    scanf("%s", pass);

    int loggedIn = 0;
    for(int i=0; i<MAX_STUDENTS; i++){
        if(strcmp(id, students[i].id)==0 && strcmp(pass, students[i].pass)==0){
            loggedIn = 1;
            break;
        }
    }
    if(!loggedIn){
        printf("Invalid ID or Password!\n");
        return;
    }

    if(totalQ==0){
        printf("No questions set yet. Ask teacher to add questions.\n");
        return;
    }

    printf("\nLogin Successful! Starting Exam...\n");

    char ans;
    int score = 0;

    for(int i=0; i<totalQ; i++){
        printf("\nQ%d: %s", i+1, qList[i].ques);
        printf("A) %s", qList[i].optA);
        printf("B) %s", qList[i].optB);
        printf("C) %s", qList[i].optC);
        printf("D) %s", qList[i].optD);

        printf("Your Answer (A/B/C/D): ");
        scanf(" %c", &ans);

        if(ans == qList[i].correct){
            score++;
            printf("Correct!\n");
        }else{
            printf("Wrong! Correct Answer: %c\n", qList[i].correct);
        }
    }

    printf("\n===== EXAM RESULT =====\n");
    printf("Student ID: %s\n", id);
    printf("Score: %d/%d\n", score, totalQ);
}

// ---------------- Main Menu
int main() {
    int choice;

    while(1){
        printf("\n--- ONLINE EXAM SYSTEM ---\n");
        printf("1) Teacher Login\n");
        printf("2) Student Login\n");
        printf("3) Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        if(choice==1)
            teacherPanel();
        else if(choice==2)
            studentPanel();
        else if(choice==3){
            printf("Exiting...\n");
            break;
        }else
            printf("Invalid choice!\n");
    }

    return 0;
}
